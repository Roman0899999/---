<!DOCTYPE html>
<html>
<head>
  <title>Загрузка инструкции</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js"></script>
</head>
<body>
  <?php
  // Подключиться к базе данных
  $mysqli = new mysqli("localhost", "root", "password", "instructions_db");

  // Проверить, вошел ли пользователь в систему
  session_start();
  if (!isset($_SESSION['username'])) {
    header("Location: login.php");
    exit;
  }

  // Обработать форму загрузки
  if (isset($_POST['submit'])) {
    $name = $_POST['name'];
    $description = $_POST['description'];
    $file = $_FILES['file'];

    // Проверить, заполнены ли все поля
    if (empty($name) || empty($description) || empty($file)) {
      echo "<p>Заполните все поля.</p>";
    } else {
      // Проверить, является ли файл PDF
      if ($file['type'] != "application/pdf") {
        echo "<p>Файл должен быть в формате PDF.</p>";
      } else {
        // Загрузить файл на сервер
        $filename = uniqid() . ".pdf";
        move_uploaded_file($file['tmp_name'], "uploads/$filename");

        // Сохранить инструкцию в базе данных
        $mysqli->query("INSERT INTO instructions (name, description, text, date_uploaded, user_id, status) VALUES ('$name', '$description', '$filename', NOW(), {$_SESSION['user_id']}, 'На рассмотрении')");

        // Перенаправить на главную страницу
        header("Location: index.php");
        exit;
      }
    }
  }
  ?>

  <h1>Загрузка инструкции</h1>
  <form action="" method="post" enctype="multipart/form-data">
    <label for="name">Название</label>
    <input type="text" name="name" id="name">

    <label for="description">Описание</label>
    <textarea name="description" id="description"></textarea>

    <label for="file">Файл</label>
    <input type="file" name="file" id="file">

    <input type="submit" name="submit" value="Загрузить">
  </form>
</body>
</html>